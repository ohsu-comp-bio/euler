################
version: '2.1'
services:

  api:
    links:
      - server:server
      - portal:portal

  # run DCC-portal-server
  server:
    container_name: server
    build:
      context: services/server
    ports:
      - "${SERVER_PORT}:${SERVER_PORT}"
      - 9200:9200
      - 9300:9300
    volumes:
      - "./.resource_data:/resource"

  # run branded OHSU-branded DCC-portal-ui
  portal:
    container_name: portal
    build:
      context: services/dcc-portal
    ports:
      - "${PORTAL_PORT}:${PORTAL_PORT}"
    volumes:
      - "${CERT_DIR_PATH}:/certs/"
    environment:
      - PORT=${PORTAL_PORT}
      - API_SOURCE=${API_URL}
      - KEY_PATH=${KEY_PATH}
      - CERT_PATH=${CERT_PATH}
      - NODE_ENV=development
